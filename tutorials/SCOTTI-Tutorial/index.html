<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="utf-8"/>
	<title>SCOTTI Tutorial</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	
	<!-- RSS feed -->
	<link rel="alternate" type="application/rss+xml" title="Taming the BEAST" href="https://taming-the-beast.org//feed.news.xml">
	<link rel="alternate" type="application/rss+xml" title="Taming the BEAST" href="https://taming-the-beast.org//feed.tutorials.xml">

	
    <!-- Favicon -->
    <link rel="shortcut icon" href="/images/favicon.ico">	

    <!-- Our style -->
    <link rel="stylesheet" type="text/css" href="/css/style.css">

    <!-- JQuery and Bootstrap JS (necessary for collapsing navbar) -->
    <script src="/js/jquery-3.6.0.min.js"></script>
    <script src="/bootstrap/js/bootstrap.bundle.min.js"></script>

    <!-- Bootstrap Icons -->
    <link rel="stylesheet" type="text/css" href="/bootstrap/icons/bootstrap-icons.css">

    <!-- KaTeX -->
    <link rel="stylesheet" href="/css/katex.css">
    <script src="/js/katex.min.js"></script>

</head>


<body>
	
	<div id="header">

  <nav class="navbar navbar-expand-lg navbar-light bg-light">
    
    <a class="navbar-brand" href="/">
      <img src="/images/logo_bw.svg" style="height:2em">Taming the BEAST
    </a>
    
  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>
  <div class="collapse navbar-collapse" id="navbarNav">
    <ul class="navbar-nav">
      <li class="nav-item active">
        <a class="nav-link " aria-current="page" href="/news/">news</a>
      </li>
      <li class="nav-item">
        <a class="nav-link " href="/workshops/">workshops</a>
      </li>
      <li class="nav-item">
        <a class="nav-link " href="/tutorials/">tutorials</a>
      </li>
      <li class="nav-item">
        <a class="nav-link " href="/contribute/">contribute</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" type="application/rss+xml" href="/feed.news.xml">
          <i class="bi bi-rss"></i>
        </a>
      </li>
    </ul>
  </div>
</nav>

</div>

	
	<div class="container">	
		
	

<div class="row">
	<div class="hidden-xs hidden-sm col-md-12">
		<div class="bigtitle titlebox">
			<ol class="breadcrumb">
			
			
				
				
				
				<li><a class="off" href="/tutorials/SCOTTI-Tutorial/">SCOTTI Tutorial</a></li>
				
			
			</ol>
		</div>
		<p>
		<div class="head">
			
				Transmission tree reconstruction with the structured coalescent
			
		</div>
		
		<div class="smallhead">
			by
			
			
				
						Louis du Plessis
					
			
				
						
							and Nicola de Maio
						
					
			
		</div>
		
	</div>				
</div>

<div class="bigspacer"></div>

<div class="row">
	<div class="col-md-3">
	<div id="sidebar">
		<div class="bigspacer"></div>
		<div class="smallhead">
			Tutorial
		</div>		
		<div class="pad-left smallnote">
			<ul class="list-unstyled">
			
			<div class="smallspacer"></div>
			<li>
				<i class="bi bi-github"></i>
				<a class="off" href="https://github.com/taming-the-beast/SCOTTI-Tutorial" target="_blank">Github repository</a>
			</li>
			<div class="smallspacer"></div>
			<li>
				<i class="bi bi-star"></i>
				<a class="off" href="LICENSE.html">
				License</a>
			</li>
			<div class="smallspacer"></div>
			<li>			
				<i class="bi bi-bar-chart"></i>
				<a class="off" href="https://github.com/taming-the-beast/SCOTTI-Tutorial/graphs/traffic" target="_blank">
				Statistics</a>
			</li>
			</ul>
		</div>		
		<div class="spacer"></div>
		 	
		<div class="smallhead">
			Data
		</div>		
		<div class="pad-left smallnote">
			<ul class="list-unstyled">
			
				
				<div class="smallspacer"></div>
				<li> 
					<i class="bi bi-justify"></i>
					<a class="off" href="https://github.com/taming-the-beast/SCOTTI-Tutorial/raw/master/data/FMDV.fasta" target="_blank" rel="nofollow">
						FMDV.fasta
					</a>
				</li>
			
				
				<div class="smallspacer"></div>
				<li> 
					<i class="bi bi-justify"></i>
					<a class="off" href="https://github.com/taming-the-beast/SCOTTI-Tutorial/raw/master/data/FMDV_dates.csv" target="_blank" rel="nofollow">
						FMDV_dates.csv
					</a>
				</li>
			
				
				<div class="smallspacer"></div>
				<li> 
					<i class="bi bi-justify"></i>
					<a class="off" href="https://github.com/taming-the-beast/SCOTTI-Tutorial/raw/master/data/FMDV_hostTimes.csv" target="_blank" rel="nofollow">
						FMDV_hostTimes.csv
					</a>
				</li>
			
				
				<div class="smallspacer"></div>
				<li> 
					<i class="bi bi-justify"></i>
					<a class="off" href="https://github.com/taming-the-beast/SCOTTI-Tutorial/raw/master/data/FMDV_hosts.csv" target="_blank" rel="nofollow">
						FMDV_hosts.csv
					</a>
				</li>
			
			</ul>
		</div>		
		<div class="spacer"></div>
		
		 	
		<div class="smallhead">
			XML
		</div>		
		<div class="pad-left smallnote">
			<ul class="list-unstyled">
			
				
				<div class="smallspacer"></div>
				<li> 
					<i class="bi bi-code-slash"></i>
					<a class="off" href="https://github.com/taming-the-beast/SCOTTI-Tutorial/raw/master/xml/FMDV.xml" target="_blank" download rel="nofollow">
						FMDV.xml
					</a>
				</li>
			
			</ul>
		</div>	
		<div class="spacer"></div>
		
		 	
		<div class="smallhead">
			Scripts
		</div>		
		<div class="pad-left smallnote">
			<ul class="list-unstyled">
			
				
				<div class="smallspacer"></div>
				<li> 
					<i class="bi bi-gear"></i>
					<a class="off" href="https://github.com/taming-the-beast/SCOTTI-Tutorial/raw/master/scripts/Make_transmission_tree.py" target="_blank" download rel="nofollow">
						Make_transmission_tree.py
					</a>
				</li>
			
				
				<div class="smallspacer"></div>
				<li> 
					<i class="bi bi-gear"></i>
					<a class="off" href="https://github.com/taming-the-beast/SCOTTI-Tutorial/raw/master/scripts/Make_transmission_tree_alternative.py" target="_blank" download rel="nofollow">
						Make_transmission_tree_alte...
					</a>
				</li>
			
				
				<div class="smallspacer"></div>
				<li> 
					<i class="bi bi-gear"></i>
					<a class="off" href="https://github.com/taming-the-beast/SCOTTI-Tutorial/raw/master/scripts/SCOTTI_generate_xml.py" target="_blank" download rel="nofollow">
						SCOTTI_generate_xml.py
					</a>
				</li>
			
			</ul>
		</div>		
		<div class="spacer"></div>
		
		 
		<div class="smallhead">
			Output
		</div>		
		<div class="pad-left smallnote">
			<ul class="list-unstyled">
			
				
				<div class="smallspacer"></div>
				<li> 
					<i class="bi bi-file-text"></i>
					<a class="off" href="https://github.com/taming-the-beast/SCOTTI-Tutorial/raw/master/precooked_runs/FMDV.MCC.tree" target="_blank" download rel="nofollow">
						FMDV.MCC.tree
					</a>
				</li>
			
				
				<div class="smallspacer"></div>
				<li> 
					<i class="bi bi-file-text"></i>
					<a class="off" href="https://github.com/taming-the-beast/SCOTTI-Tutorial/raw/master/precooked_runs/FMDV.log" target="_blank" download rel="nofollow">
						FMDV.log
					</a>
				</li>
			
				
				<div class="smallspacer"></div>
				<li> 
					<i class="bi bi-file-text"></i>
					<a class="off" href="https://github.com/taming-the-beast/SCOTTI-Tutorial/raw/master/precooked_runs/FMDV.trees" target="_blank" download rel="nofollow">
						FMDV.trees
					</a>
				</li>
			
				
				<div class="smallspacer"></div>
				<li> 
					<i class="bi bi-file-text"></i>
					<a class="off" href="https://github.com/taming-the-beast/SCOTTI-Tutorial/raw/master/precooked_runs/FMDV_transmission_network.txt" target="_blank" download rel="nofollow">
						FMDV_transmission_network.txt
					</a>
				</li>
			
			</ul>
		</div>		
		
		<div class="spacer"></div>
		<div class="smallhead">
			Contributors
		</div>	
		<div class="pad-left note">
				
			<div class="smallspacer"></div>				
			<div>
				<a class="off" href="https://github.com/laduplessis">
    			<img class="pull-left avatar" src="https://avatars.githubusercontent.com/u/8872277?v=4&s=50">
    			<div class="handlebox" style="padding-left:5px;">
    				laduplessis
    			</div>
 				</a>
 			</div>			
 				
			<div class="smallspacer"></div>				
			<div>
				<a class="off" href="https://github.com/tgvaughan">
    			<img class="pull-left avatar" src="https://avatars.githubusercontent.com/u/512538?v=4&s=50">
    			<div class="handlebox" style="padding-left:5px;">
    				tgvaughan
    			</div>
 				</a>
 			</div>			
 			
		</div>
		<div class="bigspacer"></div>
		<div class="smallhead">
			Latest commits
		</div>		
		<div class="pad-left smallnote">
			<ul class="list-unstyled">
			
				<div class="smallspacer"></div>
				<li> 
					<i class="bi bi-check-square"></i>
					<a class="off" href="https://github.com/Taming-the-BEAST/SCOTTI-Tutorial/commit/12254bfaf2ca38f8db7d8673b8eab744031b77d1">
					24 Jul 2017 - <span class="text-gray">Update LaTeX tutorial</span>
					</a> 
				</li>
			
				<div class="smallspacer"></div>
				<li> 
					<i class="bi bi-check-square"></i>
					<a class="off" href="https://github.com/Taming-the-BEAST/SCOTTI-Tutorial/commit/132140e28bba4e75e21d2442634ad14a1ba91d34">
					24 Jul 2017 - <span class="text-gray">Add second transmission network</span>
					</a> 
				</li>
			
				<div class="smallspacer"></div>
				<li> 
					<i class="bi bi-check-square"></i>
					<a class="off" href="https://github.com/Taming-the-BEAST/SCOTTI-Tutorial/commit/700c9a62187e04182cb63fb9098600ffb853a9c7">
					24 Jul 2017 - <span class="text-gray">Add Nicola's comments</span>
					</a> 
				</li>
			
				<div class="smallspacer"></div>
				<li> 
					<i class="bi bi-check-square"></i>
					<a class="off" href="https://github.com/Taming-the-BEAST/SCOTTI-Tutorial/commit/1698771991e1af19819f54a02a08a8d3fccbd730">
					22 Jul 2017 - <span class="text-gray">Small change</span>
					</a> 
				</li>
			
				<div class="smallspacer"></div>
				<li> 
					<i class="bi bi-check-square"></i>
					<a class="off" href="https://github.com/Taming-the-BEAST/SCOTTI-Tutorial/commit/b2949408c59c7e0afccf52e692088752c0efd51b">
					22 Jul 2017 - <span class="text-gray">Merge pull request #1 from tgvaughan/patch-1

Fixed filename typo</span>
					</a> 
				</li>
			
			</ul>
		</div>		
		<div class="spacer"></div>	
	</div>
	</div>

	<div class="col-md-8">				
		<div class="post">
			<p>
			<h1 id="background">Background</h1>

<p>When applying phylodynamic models to pathogen genetic sequences collected during an outbreak, we usually make the assumption that the inferred genealogy approximates the true transmission tree. In most cases the structure of the true transmission tree will be similar to the inferred genealogy and inferences about epidemiological parameters (e.g. the <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>R</mi><mi>e</mi></msub></mrow><annotation encoding="application/x-tex">R_e</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0077em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">e</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>) are valid. However, due to complicating factors, such as within-host diversity and evolution, non-sampled patients and transmission bottlenecks, it is difficult to reconstruct transmission chains or draw conclusions about the transmission dynamics between infected patients. In particular, there may be discrepancies between the epidemiological and phylogenetic relatedness of hosts and infection times are often biased.</p>

<p>SCOTTI (Structured COalescent Transmission Tree Inference) <a class="citation" href="#deMaio2016">(De Maio et al., 2016)</a> is a BEAST2 package that was developed to provide more accurate reconstructions of transmission trees.
The underlying model is a structured coalescent model, where each host is modeled as a population and migrations between populations represent new infections. 
New sequencing technologies and protocols are making it easier to sample the within-host diversity of an outbreak and SCOTTI can take advantage of multiple sequences from each host to better resolve transmission events.
Furthermore, SCOTTI can model non-sampled hosts by dynamically increasing or decreasing the number of populations (hosts). (In other structured models available in BEAST2 the number of populations remain constant and each population needs to be represented by at least one sampled sequence).
In addition to genetic sequences, SCOTTI also uses epidemiological data about host exposure times, only allowing hosts to transmit the disease during periods when they are infectious.
Thus, SCOTTI is able to model within-host diversity as well as non-sampled hosts and multiply infected hosts. However, it is currently not able to model transmission bottlenecks.</p>

<p>To make the inference tractable SCOTTI uses the same techniques as BASTA <a class="citation" href="#deMaio2015">(De Maio et al., 2015)</a>, which is a computationally efficient approximation to the structured coalescent. 
In addition, a number of simplifying assumptions are made. 
It is assumed that all hosts have the same infection rate and that it stays constant over the course of infection. It is also assumed that infection is equally likely between every pair of hosts.
Finally, it is assumed that all hosts have the same effective population size, <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>N</mi><mi>e</mi></msub></mrow><annotation encoding="application/x-tex">N_e</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.109em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">e</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>. Thus, all hosts have the same within-host genetic diversity and thus all hosts have equal and constant within-host dynamics.</p>

<hr />

<h1 id="programs-used-in-this-exercise">Programs used in this Exercise</h1>

<h3 id="beast2---bayesian-evolutionary-analysis-sampling-trees-2">BEAST2 - Bayesian Evolutionary Analysis Sampling Trees 2</h3>

<p>BEAST2 (<a href="http://www.beast2.org">http://www.beast2.org</a>) is a free software package for Bayesian evolutionary analysis of molecular sequences using MCMC and strictly oriented toward inference using rooted, time-measured phylogenetic trees. This tutorial is written for BEAST v2.4.7 <a class="citation" href="#BEAST2book2014">(Drummond &amp; Bouckaert, 2014)</a>.</p>

<h3 id="beauti2---bayesian-evolutionary-analysis-utility">BEAUti2 - Bayesian Evolutionary Analysis Utility</h3>

<p>BEAUti2 is a graphical user interface tool for generating BEAST2 XML configuration files.</p>

<p>Both BEAST2 and BEAUti2 are Java programs, which means that the exact same code runs on all platforms. For us it simply means that the interface will be the same on all platforms. The screenshots used in this tutorial are taken on a Mac OS X computer; however, both programs will have the same layout and functionality on both Windows and Linux. BEAUti2 is provided as a part of the BEAST2 package so you do not need to install it separately.</p>

<h3 id="treeannotator">TreeAnnotator</h3>

<p>TreeAnnotator is used to summarise the posterior sample of trees to produce a maximum clade credibility tree. It can also be used to summarise and visualise the posterior estimates of other tree parameters (e.g. node height).</p>

<p>TreeAnnotator is provided as a part of the BEAST2 package so you do not need to install it separately.</p>

<h3 id="tracer">Tracer</h3>

<p>Tracer (<a href="http://tree.bio.ed.ac.uk/software/tracer">http://tree.bio.ed.ac.uk/software/tracer</a>) is used to summarise the posterior estimates of the various parameters sampled by the Markov Chain. This program can be used for visual inspection and to assess convergence. It helps to quickly view median estimates and 95% highest posterior density intervals of the parameters, and calculates the effective sample sizes (ESS) of parameters. It can also be used to investigate potential parameter correlations. We will be using Tracer v1.6.0.</p>

<h3 id="figtree">FigTree</h3>

<p>FigTree (<a href="http://tree.bio.ed.ac.uk/software/figtree">http://tree.bio.ed.ac.uk/software/figtree</a>) is a program for viewing trees and producing publication-quality figures. It can interpret the node-annotations created on the summary trees by TreeAnnotator, allowing the user to display node-based statistics (e.g. posterior probabilities). We will be using FigTree v1.4.3.</p>

<h3 id="python">Python</h3>

<p>Python (<a href="https://www.python.org">https://www.python.org</a>) is an interpreted programming language that is often used to write scripts for processing text files. We will use two Python scripts during the tutorial. Both scripts should work with Python 2.7.x and Python 3.x. There is also a third, optional, script that makes use of the <code class="language-plaintext highlighter-rouge">graph-tool</code> package to produce a better looking figure.</p>

<p>Python should already be installed on most Mac OS X or Linux systems. Both graphviz and graph-tool are available on Homebrew, and graphviz can also be installed using <code class="language-plaintext highlighter-rouge">apt-get</code> on Linux systems.</p>

<hr />

<h1 id="practical-scotti-tutorial">Practical: SCOTTI tutorial</h1>

<p>In this tutorial we analyse an outbreak of Foot and Mouth Disease Virus (FMDV) that occurred in the South of England in 2007. FMDV is a highly infectious disease that affects cloven-hoofed animals (such as cattle, sheep, pigs, deer etc.) and can be easily spread between farms through contact with contaminated vehicles or animal feed. 
The usual response to FMDV is to cull all exposed livestock and quarantine surrounding farms, thus the effects of the disease can be devastating to the farming sector (the 2001 outbreak in the United Kingdom resulted in the culling of more than 10 million cows and sheep and cost £8 billion). 
It is therefore extremely important to trace the source and spread of the disease between farms. 
Because of the high genetic variability of FMDV an appreciable amount of genetic variation will accumulate over the course of an outbreak. Thus, epidemiological and evolutionary dynamics occur on the same timescale and we are dealing with a measurably evolving population, which we can analyse in BEAST.</p>

<p>When analysing an FMDV outbreak we can treat each infected farm as an infected host, with the transmission tree describing infections between farms. In fact, when discussing livestock diseases it is common to refer to infected farms as cases, instead of individual infected animals. (This analogy holds because the genetic diversity of the virus within a farm is much lower than between farms, thus each farm behaves more like a single host).</p>

<h2 id="the-data">The Data</h2>

<p>We analyse an outbreak of Foot and Mouth Disease Virus (FMDV) that occurred in the South of England. The outbreak contained two distinct clusters, in August and September of 2007, respectively. The dataset contains 11 viral sequences from 10 farms. Four sequences were sampled during the first cluster and a further 7 during the second cluster. In addition, we also have the earliest and latest possible dates during which each farm was infected with the disease, informed by the culling time and first appearance of symptoms (<a href="#fig:outbreak">Figure 1</a>). The data were first analysed in <a class="citation" href="#Cottam2008PlosPath">(Cottam et al., 2008)</a> and later reanalysed using SCOTTI in <a class="citation" href="#deMaio2016">(De Maio et al., 2016)</a>.</p>

<figure>
  <a id="fig:outbreak"></a>
  <img style="width:80.0%;" src="figures/Outbreak.png" alt="" />
  <figcaption>Figure 1: Exposure times of infected farms and sampling dates of the viral sequences (Figure taken from <a class="citation" href="#Cottam2008PlosPath">(Cottam et al., 2008)</a>). The orange shading estimates the time when animals showing symptoms of FMDV were present on a farm. Light blue shading indicates estimates for the incubation time of each farm. The dark blue shading is the infection date estimates in <a class="citation" href="#Cottam2008PlosPath">(Cottam et al., 2008)</a>. The haplotype network of the sequenced strains is superimposed on the exposure times. The red dots indicate the dates of the sampled sequences.
</figcaption>
</figure>
<p><br /></p>

<h2 id="creating-the-input-files-using-the-included-python-script">Creating the input files using the included Python script</h2>

<p>Unlike most BEAST2 packages, SCOTTI does not have a BEAUti interface. Although a BEAUti interface makes it much easier, it is not the only way to create the input XML file for a BEAST2 analysis. 
Many advanced users prefer to create the XML file in a text editor as this provides them with greater flexibility and oversight. Even if you use BEAUti to create your configuration files it is always a good idea to open the XML file in a text editor and check that everything is where it should be.
At first glance a BEAST2 XML file may seem bewildering, but the file has a rigid structure and after a while you will be able to interpret the different elements of the configuration file.
Being able to read and understand a configuration file gives you a much better understanding of how the different parts of an analysis fit together.
In addition, it gives you access to models (such as SCOTTI) that do not have BEAUti interfaces.
Once you are familiar with the structure of BEAST2 XML files and you know the different inputs of the models you want to use you will find that it is often faster to directly edit an XML file than to create it in BEAUti.</p>

<p>In this tutorial we we will start at the shallow end of the pool and use a Python script, <code class="language-plaintext highlighter-rouge">SCOTTI_generate_xml.py</code>, to create the XML configuration file. It is included with the SCOTTI package and is also stored in the <code class="language-plaintext highlighter-rouge">scripts/</code> directory of this tutorial.</p>

<h3 id="installing-the-scotti-package">Installing the SCOTTI package</h3>

<p>Before we can use SCOTTI we have to install the package somewhere where BEAST2 can find it. Although we won’t use BEAUti to create the input configuration file, we still have to use BEAUti to install the package. We will be using SCOTTI version 1.1.1 or above for this tutorial.</p>

<blockquote>
  <p>Open <strong>BEAUti</strong> and open the <strong>BEAST2 Package Manager</strong> by navigating to <strong>File &gt; Manage Packages</strong>.</p>

  <p>Install <strong>SCOTTI</strong> by selecting it and clicking the <strong>Install/Upgrade</strong> button (<a href="#fig:packagemanager">Figure 2</a>)</p>

</blockquote>

<figure>
  <a id="fig:packagemanager"></a>
  <img style="width:80.0%;" src="figures/PackageManager.png" alt="" />
  <figcaption>Figure 2: Installing the SCOTTI package.</figcaption>
</figure>
<p><br /></p>

<h3 id="running-the-python-script">Running the Python script</h3>

<blockquote>
  <p>Open a terminal if you are using Mac OS X or Linux, or a Command Prompt if you are using Windows.</p>

  <p>Navigate to the directory where the <code class="language-plaintext highlighter-rouge">SCOTTI_generate_xml.py</code> script is stored.</p>

  <p>Type <code class="language-plaintext highlighter-rouge">python SCOTTI_generate_xml.py --help</code></p>

</blockquote>

<p>This will display help for the different input arguments of the script:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
usage: SCOTTI_generate_xml.py <span class="o">[</span><span class="nt">-h</span><span class="o">]</span> <span class="o">[</span><span class="nt">--fasta</span> FASTA] <span class="o">[</span><span class="nt">--output</span> OUTPUT]
                              <span class="o">[</span><span class="nt">--overwrite</span><span class="o">]</span> <span class="o">[</span><span class="nt">--dates</span> DATES] <span class="o">[</span><span class="nt">--hosts</span> HOSTS]
                              <span class="o">[</span><span class="nt">--hostTimes</span> HOSTTIMES] <span class="o">[</span><span class="nt">--maxHosts</span> MAXHOSTS]
                              <span class="o">[</span><span class="nt">--unlimLife</span><span class="o">]</span> <span class="o">[</span><span class="nt">--penalizeMigration</span><span class="o">]</span>
                              <span class="o">[</span><span class="nt">--numIter</span> NUMITER]
                              <span class="o">[</span><span class="nt">--mutationModel</span> MUTATIONMODEL]
                              <span class="o">[</span><span class="nt">--fixedAs</span> FIXEDAS] <span class="o">[</span><span class="nt">--fixedCs</span> FIXEDCS]
                              <span class="o">[</span><span class="nt">--fixedGs</span> FIXEDGS] <span class="o">[</span><span class="nt">--fixedTs</span> FIXEDTS]
                              <span class="o">[</span><span class="nt">--tracelog</span> TRACELOG] <span class="o">[</span><span class="nt">--screenlog</span> SCREENLOG]
                              <span class="o">[</span><span class="nt">--treelog</span> TREELOG]

optional arguments:
  <span class="nt">-h</span>, <span class="nt">--help</span>            show this <span class="nb">help </span>message and <span class="nb">exit</span>
  <span class="nt">--fasta</span> FASTA, <span class="nt">-f</span> FASTA
                        Input fasta alignment. If not specified, looks <span class="k">in </span>th
                        working directory <span class="k">for </span>SCOTTI_aligment.fas
  <span class="nt">--output</span> OUTPUT, <span class="nt">-o</span> OUTPUT
                        output file that will contain the newly created SCOTTI
                        xml to be run with BEAST2.
  <span class="nt">--overwrite</span>, <span class="nt">-ov</span>      Overwrite output files.
  <span class="nt">--dates</span> DATES, <span class="nt">-d</span> DATES
                        Input csv file with sampling dates associated to each
                        sample name <span class="o">(</span>same name as fasta file<span class="o">)</span><span class="nb">.</span> If not
                        specified, looks <span class="k">for </span>SCOTTI_dates.csv
  <span class="nt">--hosts</span> HOSTS, <span class="nt">-ho</span> HOSTS
                        Input csv file with sampling hosts associated to each
                        sample name <span class="o">(</span>same name as fasta file<span class="o">)</span><span class="nb">.</span> If not
                        specified, looks <span class="k">for </span>SCOTTI_hosts.csv
  <span class="nt">--hostTimes</span> HOSTTIMES, <span class="nt">-ht</span> HOSTTIMES
                        Input csv file with the earliest <span class="nb">times </span><span class="k">in </span>which hosts
                        are infectable, and latest <span class="nb">time </span>when hosts are
                        infective. Use same host names as those used <span class="k">for </span>the
                        sampling hosts file. If not specified, looks <span class="k">for
                        </span>SCOTTI_hostTimes.csv

  ...
  ...
  ...

  <span class="nt">--treelog</span> TREELOG, <span class="nt">-tl</span> TREELOG
                        Logging frequency <span class="k">in </span>the tree file.
                        <span class="nv">Default</span><span class="o">=</span>numIter/1000.

</code></pre></div></div>

<p>We see that we have to provide the script with four input files:</p>

<ul>
  <li>A fasta file, containing the genetic sequences.</li>
  <li>A dates file, containing the sampling dates for each sequence.</li>
  <li>A hosts file, containing a mapping from each sequence to the host it was sampled from.</li>
  <li>A hostTimes file, containing the earliest and latest dates when hosts are infectious. Thus, these dates correspond to the introduction and removal of hosts to the outbreak (for instance in a hospital setting these dates will correspond to a patient’s admission and release dates).</li>
</ul>

<p>The dates, hosts and hostTimes files need to be csv-files (comma-separated values). All dates have to be provided in numbers. All four input files for the FMDV outbreak are provided in the <code class="language-plaintext highlighter-rouge">data/</code> directory of this tutorial.</p>

<p>The sequence file:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
&gt;IP3c-46
-----------------GGTCTCACCCCTAGTAAGCCAACGACAGTCCCTGCGTTGCACTCCACA...
&gt;IP5-51
-----------------GGTCTCACCCCTAGTAAGCCAACGACAGTCCCTGCGTTGCACTCCACA...
&gt;IP8-62
-----------------GGTCTCACCCCTAGTAAGCCAACGACAGTCCCTGCGTTGCACTCCACA...

... 

&gt;IP1b-4
-----------------GGTCTCACCCCTAGTAAGCCAACGACAGTCCCTGCGTTGCACTCCACA...

</code></pre></div></div>

<p>The dates file:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
IP3c-46, 46.0
IP5-51, 51.0
IP8-62, 62.0

...

IP6b-54, 54.0

</code></pre></div></div>

<p>The hosts file:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
IP1b-3, IP1b
IP1b-4, IP1b
IP2b-6, IP2b

...

IP8-62, IP8

</code></pre></div></div>

<p>The hostTimes file:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
IP1b, -26.0, 7.0
IP2b, -16.0, 9.0
IP2c, -9.0, 10.0

...

IP8, 43.0, 63.0

</code></pre></div></div>

<p>Note that the script assumes that times are specified forward-in-time, thus the largest times are the ones closest to the present. In this analysis we specify time in days from the start of the outbreak (day 0). Thus, in the hostTimes file, where times are negative, that indicates that we believe those farms could have been infected weeks before the outbreak was first detected.</p>

<blockquote>
  <p>Type in:</p>

  <p><code class="language-plaintext highlighter-rouge">python SCOTTI_generate_xml.py --fasta ../data/FMDV.fasta  --dates ../data/FMDV_dates.csv --hosts ../data/FMDV_hosts.csv --hostTimes ../data/FMDV_hostTimes.csv --output FMDV --maxHosts 20 --numIter 2000000 --tracelog 2000 --treelog 20000 --screenlog 20000</code></p>

</blockquote>

<p>This will create the input XML file for the BEAST2 analysis. You may have to change the paths to the input files before the command will work (the <code class="language-plaintext highlighter-rouge">--fasta</code>, <code class="language-plaintext highlighter-rouge">--dates</code>, <code class="language-plaintext highlighter-rouge">--hosts</code> and <code class="language-plaintext highlighter-rouge">--hostTimes</code> arguments). We also specified the following additional optional arguments:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">--output</code>: The name of the output XML file and the <code class="language-plaintext highlighter-rouge">.log</code> and <code class="language-plaintext highlighter-rouge">.tree</code> files that will be produced by BEAST2.</li>
  <li><code class="language-plaintext highlighter-rouge">--maxHosts</code>: The maximum number of hosts in the outbreak, including observed and unobserved hosts. Since we have data from 10 farms and no cases were found in any other farms it is unlikely that more than 20 farms were infected. We can also make the analysis run faster by restricting the maximum number of hosts to a smaller number.</li>
  <li><code class="language-plaintext highlighter-rouge">--numIter</code>: We restrict the length of the chain to 2’000’000 states.</li>
  <li><code class="language-plaintext highlighter-rouge">--traceLog</code>, <code class="language-plaintext highlighter-rouge">--treelog</code>, <code class="language-plaintext highlighter-rouge">--screenlog</code>: The frequency at which states are saved in the log file and tree files or output to the screen. By default the Python script will scale these frequencies to log 10’000 states and 1’000 trees. Since our chain only includes 2’000’000 states this results in states being sampled too frequently which in turn results in high auto-correlation between sampled states and low ESS values.</li>
</ul>

<blockquote>
  <p><strong>Topic for discussion:</strong> Read the help for the <code class="language-plaintext highlighter-rouge">--unlimLife</code> and <code class="language-plaintext highlighter-rouge">--penalizeMigration</code> input arguments to the Python script. Can you figure out what these arguments do? How do you think setting these arguments to true will affect the results?</p>

</blockquote>

<h2 id="running-the-analysis">Running the analysis</h2>

<p>We should now be ready to run the analysis in BEAST2.</p>

<blockquote>
  <p>Open <strong>BEAST2</strong> and choose <code class="language-plaintext highlighter-rouge">FMDV.xml</code> as the BEAST XML file. If BEAGLE is installed check the box to use it. Then click <strong>Run</strong> (<a href="#fig:beastmcmc">Figure 3</a>).</p>

</blockquote>

<figure>
  <a id="fig:beastmcmc"></a>
  <img style="width:50.0%;" src="figures/BEASTMCMCseed.png" alt="" />
  <figcaption>Figure 3: Running the analysis in BEAST2.</figcaption>
</figure>
<p><br /></p>

<p>If you use the seed 2007 you should be able to duplicate the results in the next section. The analysis should take between 10 and 20 minutes to run. While the analysis is running open the XML file in a text editor and see if you can identify the different model components.</p>

<blockquote>
  <p><strong>Topic for discussion:</strong> The Python script we used to create the configuration file only allows us to choose between a Jukes-Cantor or HKY site model, without any rate heterogeneity or invariant sites. In addition, it only allows one locus/partition in the alignment and uses a strict clock. It also doesn’t give us any options for setting different priors or operators.</p>

  <p>Do you think there are situations where you would want to use a different site or clock model? What about the model priors? In particular, which priors would you want to change?</p>

  <p>Suppose you wanted to perform a SCOTTI analysis using a GTR substitution with a lognormal relaxed clock. How would you go about it?</p>

</blockquote>

<h2 id="analysing-the-output-in-tracer-and-figtree">Analysing the output in Tracer and FigTree</h2>

<blockquote>
  <p>Open <strong>Tracer</strong> and load the file <code class="language-plaintext highlighter-rouge">FMDV.log</code>. Click on the <strong>Trace</strong> tab and examine the parameter traces.</p>

</blockquote>

<p>The Python script only logs a few key parameters (<a href="#fig:tracer">Figure 4</a>). Note that not all parameters have perfect mixing. For a real analysis we would run the chain much longer and aim to collect at least 10’000 samples (this log file contains only 1’000 samples).</p>

<figure>
  <a id="fig:tracer"></a>
  <img style="width:80.0%;" src="figures/Tracer.png" alt="" />
  <figcaption>Figure 4: The results of the analysis in Tracer.</figcaption>
</figure>
<p><br /></p>

<blockquote>
  <p>Click on <strong>Estimates</strong> and select <strong>migmodel.numPops</strong>.</p>

  <p>Since this is an integer parameter click on <strong>(I)nt</strong> at the bottom of the panel (<a href="#fig:numPops">Figure 5</a>).</p>

</blockquote>

<figure>
  <a id="fig:numPops"></a>
  <img style="width:80.0%;" src="figures/Tracer_numPops.png" alt="" />
  <figcaption>Figure 5: Estimates for the number of infected farms.</figcaption>
</figure>
<p><br /></p>

<p>This parameter estimates the number of hosts in the outbreak. It is bounded below by 10 (the number of sampled farms) and above by 20, which was our input upper bound. 
However, it is difficult to interpret this parameter as the number of farms that were infected, because (i) one non-sampled deme may actually represent a series of hosts with no time overlap, or a single host with unlimited exposure time (like environmental contamination); (ii) non-sampled hosts are not necessarily infected; (iii) many non-sampled hosts might just represent one host with large population size, like an environmental endemic source.</p>

<p>The parameter <strong>migModel.popSize</strong> logs the effective population size of the hosts, which is directly proportional to the genetic diversity of the virus within each farm. We see that the effective population size is quite low, which is probably due to the relatively short period of the outbreak. The equal infection rate between farms is logged by <strong>migModel.rateMig</strong> and the clock rate by <strong>mutationRate</strong>. If the clock rate seems low for a virus, keep in mind that we measure time in days. Thus, the units for substitutions are in substitutions/site/day instead of the usual substitutions/site/year.</p>

<blockquote>
  <p>Select <strong>tree.height</strong> (<a href="#fig:tmrca">Figure 6</a>)</p>

</blockquote>

<figure>
  <a id="fig:tmrca"></a>
  <img style="width:80.0%;" src="figures/Tracer_TMRCA.png" alt="" />
  <figcaption>Figure 6: Estimates for the TMRCA.</figcaption>
</figure>
<p><br /></p>

<p>This parameter is the TMRCA of the sequences included in the transmission tree. The median estimate is 67.36 days, with a 95% HPD between 60.76 and 78.55 days. Since the most recent sample was taken on day 62 of the outbreak (IP8-62), this indicates that it is unlikely that the outbreak started more than a week before it was discovered and confirmed, which is an encouraging sign for the surveillance of foot and mouth disease in the United Kingdom.</p>

<blockquote>
  <p>Open <strong>TreeAnnotator</strong> and set the <strong>Burnin percentage</strong> to 10. Leave the other options unchanged.</p>

  <p>Load the file <code class="language-plaintext highlighter-rouge">FMDV.trees</code> and change the <strong>Output file</strong> to <code class="language-plaintext highlighter-rouge">FMDV.MCC.tree</code> (<a href="#fig:treeannotator">Figure 7</a>).</p>

</blockquote>

<figure>
  <a id="fig:treeannotator"></a>
  <img style="width:50.0%;" src="figures/TreeAnnotator.png" alt="" />
  <figcaption>Figure 7: Creating the MCC tree.</figcaption>
</figure>
<p><br /></p>

<blockquote>
  <p>Open <strong>FigTree</strong> and load <code class="language-plaintext highlighter-rouge">FMDV.MCC.tree</code>.</p>

  <p>Click on the arrow to the right <strong>Appearance</strong> and in the <strong>Colour by</strong> dropdown box select <strong>host</strong>. Check <strong>Gradient</strong> and increase the <strong>Line Weight</strong> to <strong>5</strong>.</p>

  <p>Increase the <strong>Font Size</strong> under <strong>Tip Labels</strong> and change <strong>Display</strong> to <strong>host</strong>. Check <strong>Node Labels</strong> and select <strong>host.prob</strong> from the dropdown box and increase the <strong>Font size</strong>.</p>

  <p>Under <strong>Node Shape</strong> select <strong>Circle</strong> and set the size by <strong>host.prob</strong> and the colour by <strong>host</strong>.</p>

  <p>Check <strong>Legend</strong> and select <strong>host</strong> as <strong>Attribute</strong>.</p>

</blockquote>

<figure>
  <a id="fig:figtree"></a>
  <img style="width:100.0%;" src="figures/FigTree.png" alt="" />
  <figcaption>Figure 8: The MCC tree in FigTree.</figcaption>
</figure>
<p><br /></p>

<p>We see that in the MCC tree (<a href="#fig:figtree">Figure 8</a>) one node is an unsampled node (between the two outbreak clusters). Thus, there is evidence of a non-sampled farm between IP2b and IP5. We further see that while the posterior probabilities for some internal nodes are quite high, it is below 0.5 for several nodes. Note that since SCOTTI does not model the transmission bottleneck it cannot estimate the time of infection. Thus, it is better to display the tree with a gradient between hosts than with a discrete colouring.</p>

<blockquote>
  <p>Under <strong>Node Labels</strong> change the <strong>Display</strong> attribute first to <strong>host.set</strong> and then to <strong>host.set.prob</strong> (<a href="#fig:hostsets">Figure 9</a>)</p>

</blockquote>

<figure>
  <a id="fig:hostsets"></a>
  <img style="width:100.0%;" src="figures/FigTreeSet.png" alt="" />
  <figcaption>Figure 9: The sets of probable hosts in FigTree.</figcaption>
</figure>
<p><br /></p>

<p>This displays respectively the set of hosts with a non-zero posterior probability and the posterior probability for those nodes. We see that although many internal nodes have a large set of possible hosts, only two or three hosts have reasonably large posterior probabilities for each internal node.</p>

<h2 id="constructing-the-transmission-network">Constructing the transmission network</h2>

<p>The MCC tree is a summary of the set of posterior trees. Although it is useful it is not necessarily the best way to look at the transmission tree. We will use a Python script to construct a transmission network that shows the probabilities of transmissions between every pair of farms. We will use the script <code class="language-plaintext highlighter-rouge">Make_transmission_tree_alternative.py</code>, which uses the <code class="language-plaintext highlighter-rouge">graphviz</code> package. If this package is not installed you will have to install it, either through Homebrew or by installing the Anaconda Python distribution. Alternatively, if you have previously installed the <code class="language-plaintext highlighter-rouge">graph-tool</code> package you may use the script <code class="language-plaintext highlighter-rouge">Make_transmission_tree.py</code>, which will produce better looking figures.</p>

<blockquote>
  <p>Open a terminal if you are using Mac OS X or Linux, or a Command Prompt if you are using Windows.</p>

  <p>Navigate to the directory where the <code class="language-plaintext highlighter-rouge">Make_transmission_tree_alternative.py</code> script is stored.</p>

  <p>Type in <code class="language-plaintext highlighter-rouge">python Make_transmission_tree_alternative.py --input ../precooked_runs/FMDV.trees --outputF FMDV_transmission --burnin 10</code></p>

</blockquote>

<p>This will create 3 files:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">FMDV_transmission_direct_transmissions.jpg</code></li>
  <li><code class="language-plaintext highlighter-rouge">FMDV_transmission_indirect_transmissions</code></li>
  <li><code class="language-plaintext highlighter-rouge">FMDV_transmission_network.txt</code></li>
</ul>

<figure>
  <a id="fig:hostsets"></a>
  <img src="figures/FMDV_transmission_direct_transmissions.jpg" alt="" />
  <figcaption>Figure 9: The direct transmission network using graphviz (Make_transmission_tree_alternative.py).</figcaption>
</figure>
<p><br /></p>

<figure>
  <a id="fig:hostsets"></a>
  <img src="figures/FMDV3_out_direct_transmissions.png" alt="" />
  <figcaption>Figure 10: The direct transmission network using graph-tool (Make_transmission_tree.py).</figcaption>
</figure>
<p><br /></p>

<p>The network of direct transmissions is shown in <a href="fig:transmissiontree1">Figure 10</a>. By default only transmissions with a probability bigger than 10% are shown. We can identify a few key points from the transmission network. First, the chance of a direct transmission between the first and the second cluster (betwen IP2b and IP5) is quite low, thus there is a large chance that there are some non-sampled farms. There also appears to be evidence for non-sampled farm(s) between IP5 and the other farms in the second cluster. Secondly, it appears likely that IP3b was responsible either directly or indirectly, for the infection of IP6b, IP7 and IP8. In several parts of the network there are a number of possible transmission routes, however in most cases one route is more likely than others. For example, it is more likely that IP1b infected IP2c and that IP7 infected IP8 than vice-versa. It also appears likely that IP1b was the first infected farm. This information is also summarised in the text file <code class="language-plaintext highlighter-rouge">FMDV_transmission_network.txt</code>.</p>

<p>Although this information is very useful for informing us about the transmission dynamics of an outbreak we should be careful not to over-interpret the results. There is still a lot of uncertainty in the transmission network, thus a link in the network does not necessarily indicate a definite transmission pair. Moreover, the presence of non-sampled hosts make it difficult to unambiguously identify transmission pairs or superspreaders.</p>

<hr />

<h1 id="useful-links">Useful Links</h1>

<ul>
  <li>SCOTTI website with documentation: <a href="https://bitbucket.org/nicofmay/scotti/">https://bitbucket.org/nicofmay/scotti/</a></li>
  <li><a href="http://www.beast2.org/book.html">Bayesian Evolutionary Analysis with BEAST 2</a> <a class="citation" href="#BEAST2book2014">(Drummond &amp; Bouckaert, 2014)</a></li>
  <li>BEAST 2 website and documentation: <a href="http://www.beast2.org/">http://www.beast2.org/</a></li>
  <li>Join the BEAST user discussion: <a href="http://groups.google.com/group/beast-users">http://groups.google.com/group/beast-users</a></li>
</ul>

<hr />

<h1 id="relevant-references">Relevant References</h1>

<ol class="bibliography"><li><span id="deMaio2016">De Maio, N., Wu, C.-H., &amp; Wilson, D. J. (2016). SCOTTI: Efficient Reconstruction of Transmission within Outbreaks with the Structured Coalescent. <i>PLOS Computational Biology</i>, <i>12</i>(9), e1005130. https://doi.org/10.1371/journal.pcbi.1005130</span></li>
<li><span id="deMaio2015">De Maio, N., Wu, C.-H., O’Reilly, K. M., &amp; Wilson, D. (2015). New Routes to Phylogeography: A Bayesian Structured Coalescent Approximation. <i>PLOS Genetics</i>, <i>11</i>(8), e1005421. https://doi.org/10.1371/journal.pgen.1005421</span></li>
<li><span id="BEAST2book2014">Drummond, A. J., &amp; Bouckaert, R. R. (2014). <i>Bayesian evolutionary analysis with BEAST 2</i>. Cambridge University Press.</span></li>
<li><span id="Cottam2008PlosPath">Cottam, E. M., Wadsworth, J., Shaw, A. E., Rowlands, R. J., Goatley, L., Maan, S., Maan, N. S., Mertens, P. P. C., Ebert, K., Li, Y., Ryan, E. D., Juleff, N., Ferris, N. P., Wilesmith, J. W., Haydon, D. T., King, D. P., Paton, D. J., &amp; Knowles, N. J. (2008). Transmission Pathways of Foot-and-Mouth Disease Virus in the United Kingdom in 2007. <i>PLOS Pathogens</i>, <i>4</i>(4), e1000050. https://doi.org/10.1371/journal.ppat.1000050</span></li></ol>



			<hr>
			<h1>Citation</h1>

			
<p>If you found <strong>Taming the BEAST</strong> helpful in designing your research, please cite the following paper:</p>

<p style="margin-left: 40px">
Joëlle Barido-Sottani, Veronika Bošková, Louis du Plessis, Denise Kühnert, Carsten Magnus, Venelin Mitov, Nicola F. Müller, Jūlija Pečerska, David A. Rasmussen, Chi Zhang, Alexei J. Drummond, Tracy A. Heath, Oliver G. Pybus, Timothy G. Vaughan, Tanja Stadler (2018). Taming the BEAST – A community teaching material resource for BEAST 2. <em>Systematic Biology</em>, <em>67(1)</em>, 170–-174. doi: <a target="_blank" href="https://doi.org/10.1093/sysbio/syx060">10.1093/sysbio/syx060</a>
</p> 
		</div>
	</div>			
	<div class="col-md-1"></div>
</div>


	
	</div>

	<div class="footerspacer"></div>

<div class="footer">
  <div class="container">
    <div class="row">
      <div class="col-md-6">
        <ul class="list-group list-group-horizontal">
        <li class="footernav list-group-item"><a class="foot" href="/about/">about</a></li>
        <li class="footernav list-group-item"><a class="foot" href="/contact/">contact</a></li>
        <li class="footernav list-group-item"><a class="foot" href="/license/">license</a></li>
        </ul>
      </div>
    </div>
  </div>
</div>

	
	<!--div id="footer"><span style="display:none">foo</span></div-->
		
</body>
</html>

