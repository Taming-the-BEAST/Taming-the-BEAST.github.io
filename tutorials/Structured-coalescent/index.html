<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="utf-8"/>
	<title>Structured coalescent</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	
	<!-- RSS feed -->
	<link rel="alternate" type="application/rss+xml" title="Taming the BEAST" href="https://taming-the-beast.org//feed.news.xml">
	<link rel="alternate" type="application/rss+xml" title="Taming the BEAST" href="https://taming-the-beast.org//feed.tutorials.xml">

	
    <!-- Favicon -->
    <link rel="shortcut icon" href="/images/favicon.ico">	

    <!-- Our style -->
    <link rel="stylesheet" type="text/css" href="/css/style.css">

    <!-- JQuery and Bootstrap JS (necessary for collapsing navbar) -->
    <script src="/js/jquery-3.6.0.min.js"></script>
    <script src="/bootstrap/js/bootstrap.bundle.min.js"></script>

    <!-- Bootstrap Icons -->
    <link rel="stylesheet" type="text/css" href="/bootstrap/icons/bootstrap-icons.css">

    <!-- KaTeX -->
    <link rel="stylesheet" href="/css/katex.css">
    <script src="/js/katex.min.js"></script>

</head>


<body>
	
	<div id="header">

  <nav class="navbar navbar-expand-lg navbar-light bg-light">
    
    <a class="navbar-brand" href="/">
      <img src="/images/logo_bw.svg" style="height:2em">Taming the BEAST
    </a>
    
  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>
  <div class="collapse navbar-collapse" id="navbarNav">
    <ul class="navbar-nav">
      <li class="nav-item active">
        <a class="nav-link " aria-current="page" href="/news/">news</a>
      </li>
      <li class="nav-item">
        <a class="nav-link " href="/workshops/">workshops</a>
      </li>
      <li class="nav-item">
        <a class="nav-link " href="/tutorials/">tutorials</a>
      </li>
      <li class="nav-item">
        <a class="nav-link " href="/contribute/">contribute</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" type="application/rss+xml" href="/feed.news.xml">
          <i class="bi bi-rss"></i>
        </a>
      </li>
    </ul>
  </div>
</nav>

</div>

	
	<div class="container">	
		
	

<div class="row">
	<div class="hidden-xs hidden-sm col-md-12">
		<div class="bigtitle titlebox">
			<ol class="breadcrumb">
			
			
				
				
				
				<li><a class="off" href="/tutorials/Structured-coalescent/">Structured coalescent</a></li>
				
			
			</ol>
		</div>
		<p>
		<div class="head">
			
				Population structure using MultiTypeTree
			
		</div>
		
		<div class="smallhead">
			by
			
			
				
						Nicola F. Müller
					
			
				
						
							and Tim Vaughan
						
					
			
		</div>
		
	</div>				
</div>

<div class="bigspacer"></div>

<div class="row">
	<div class="col-md-3">
	<div id="sidebar">
		<div class="bigspacer"></div>
		<div class="smallhead">
			Tutorial
		</div>		
		<div class="pad-left smallnote">
			<ul class="list-unstyled">
			
			<div class="smallspacer"></div>
			<li>
				<i class="bi bi-github"></i>
				<a class="off" href="https://github.com/taming-the-beast/Structured-coalescent" target="_blank">Github repository</a>
			</li>
			<div class="smallspacer"></div>
			<li>
				<i class="bi bi-star"></i>
				<a class="off" href="LICENSE.html">
				License</a>
			</li>
			<div class="smallspacer"></div>
			<li>			
				<i class="bi bi-bar-chart"></i>
				<a class="off" href="https://github.com/taming-the-beast/Structured-coalescent/graphs/traffic" target="_blank">
				Statistics</a>
			</li>
			</ul>
		</div>		
		<div class="spacer"></div>
		 	
		<div class="smallhead">
			Data
		</div>		
		<div class="pad-left smallnote">
			<ul class="list-unstyled">
			
				
				<div class="smallspacer"></div>
				<li> 
					<i class="bi bi-justify"></i>
					<!--a class="off" href="https://github.com/taming-the-beast/Structured-coalescent/raw/master/data/h3n2_2deme.fna" target="_blank" rel="nofollow"-->
					<a class="off" href="https://raw.githubusercontent.com/taming-the-beast/Structured-coalescent/master/data/h3n2_2deme.fna" target="_blank" rel="nofollow">
						h3n2_2deme.fna
					</a>
				</li>
			
			</ul>
		</div>		
		<div class="spacer"></div>
		
		 	
		<div class="smallhead">
			XML
		</div>		
		<div class="pad-left smallnote">
			<ul class="list-unstyled">
			
				
				<div class="smallspacer"></div>
				<li> 
					<i class="bi bi-code-slash"></i>
					<!--a class="off" href="https://github.com/taming-the-beast/Structured-coalescent/raw/master/xml/MTT.xml" target="_blank" download rel="nofollow"-->
					<a class="off" href="https://raw.githubusercontent.com/taming-the-beast/Structured-coalescent/master/xml/MTT.xml" target="_blank" rel="nofollow">
						MTT.xml
					</a>
				</li>
			
			</ul>
		</div>	
		<div class="spacer"></div>
		
		
		 
		<div class="smallhead">
			Output
		</div>		
		<div class="pad-left smallnote">
			<ul class="list-unstyled">
			
				
				<div class="smallspacer"></div>
				<li> 
					<i class="bi bi-file-text"></i>
					<!--a class="off" href="https://github.com/taming-the-beast/Structured-coalescent/raw/master/precooked_runs/MTT.h3n2_2deme.MCC.tree" target="_blank" download rel="nofollow"-->
					<a class="off" href="https://raw.githubusercontent.com/taming-the-beast/Structured-coalescent/master/precooked_runs/MTT.h3n2_2deme.MCC.tree" target="_blank" rel="nofollow">
						MTT.h3n2_2deme.MCC.tree
					</a>
				</li>
			
				
				<div class="smallspacer"></div>
				<li> 
					<i class="bi bi-file-text"></i>
					<!--a class="off" href="https://github.com/taming-the-beast/Structured-coalescent/raw/master/precooked_runs/MTT.h3n2_2deme.map.trees" target="_blank" download rel="nofollow"-->
					<a class="off" href="https://raw.githubusercontent.com/taming-the-beast/Structured-coalescent/master/precooked_runs/MTT.h3n2_2deme.map.trees" target="_blank" rel="nofollow">
						MTT.h3n2_2deme.map.trees
					</a>
				</li>
			
				
				<div class="smallspacer"></div>
				<li> 
					<i class="bi bi-file-text"></i>
					<!--a class="off" href="https://github.com/taming-the-beast/Structured-coalescent/raw/master/precooked_runs/MTT.h3n2_2deme.trees" target="_blank" download rel="nofollow"-->
					<a class="off" href="https://raw.githubusercontent.com/taming-the-beast/Structured-coalescent/master/precooked_runs/MTT.h3n2_2deme.trees" target="_blank" rel="nofollow">
						MTT.h3n2_2deme.trees
					</a>
				</li>
			
				
				<div class="smallspacer"></div>
				<li> 
					<i class="bi bi-file-text"></i>
					<!--a class="off" href="https://github.com/taming-the-beast/Structured-coalescent/raw/master/precooked_runs/MTT.h3n2_2deme.typedNode.trees" target="_blank" download rel="nofollow"-->
					<a class="off" href="https://raw.githubusercontent.com/taming-the-beast/Structured-coalescent/master/precooked_runs/MTT.h3n2_2deme.typedNode.trees" target="_blank" rel="nofollow">
						MTT.h3n2_2deme.typedNode.trees
					</a>
				</li>
			
				
				<div class="smallspacer"></div>
				<li> 
					<i class="bi bi-file-text"></i>
					<!--a class="off" href="https://github.com/taming-the-beast/Structured-coalescent/raw/master/precooked_runs/MTT.log" target="_blank" download rel="nofollow"-->
					<a class="off" href="https://raw.githubusercontent.com/taming-the-beast/Structured-coalescent/master/precooked_runs/MTT.log" target="_blank" rel="nofollow">
						MTT.log
					</a>
				</li>
			
			</ul>
		</div>		
		
		<div class="spacer"></div>
		<div class="smallhead">
			Contributors
		</div>	
		<div class="pad-left note">
				
			<div class="smallspacer"></div>				
			<div>
				<a class="off" href="https://github.com/laduplessis">
    			<img class="pull-left avatar" src="https://avatars.githubusercontent.com/u/8872277?v=4&s=50">
    			<div class="handlebox" style="padding-left:5px;">
    				laduplessis
    			</div>
 				</a>
 			</div>			
 				
			<div class="smallspacer"></div>				
			<div>
				<a class="off" href="https://github.com/jugne">
    			<img class="pull-left avatar" src="https://avatars.githubusercontent.com/u/26361891?v=4&s=50">
    			<div class="handlebox" style="padding-left:5px;">
    				jugne
    			</div>
 				</a>
 			</div>			
 				
			<div class="smallspacer"></div>				
			<div>
				<a class="off" href="https://github.com/tgvaughan">
    			<img class="pull-left avatar" src="https://avatars.githubusercontent.com/u/512538?v=4&s=50">
    			<div class="handlebox" style="padding-left:5px;">
    				tgvaughan
    			</div>
 				</a>
 			</div>			
 			
		</div>
		<div class="bigspacer"></div>
		<div class="smallhead">
			Latest commits
		</div>		
		<div class="pad-left smallnote">
			<ul class="list-unstyled">
			
				<div class="smallspacer"></div>
				<li> 
					<i class="bi bi-check-square"></i>
					<a class="off" href="https://github.com/Taming-the-BEAST/Structured-coalescent/commit/27ed57077fe9d37618634c890f1ccd60abd86fec">
					11 Aug 2025 - <span class="text-gray">Merge pull request #3 from jugne/master

Updated TtB tutorial to work with BEAUti template upgrade</span>
					</a> 
				</li>
			
				<div class="smallspacer"></div>
				<li> 
					<i class="bi bi-check-square"></i>
					<a class="off" href="https://github.com/Taming-the-BEAST/Structured-coalescent/commit/7b8dac33fe29ae6e00dee57d37961db6d3013df3">
					08 Aug 2025 - <span class="text-gray">Figure size update</span>
					</a> 
				</li>
			
				<div class="smallspacer"></div>
				<li> 
					<i class="bi bi-check-square"></i>
					<a class="off" href="https://github.com/Taming-the-BEAST/Structured-coalescent/commit/4943e741cd45e3161bdaa587f53567980726b04a">
					08 Aug 2025 - <span class="text-gray">Updated XML</span>
					</a> 
				</li>
			
				<div class="smallspacer"></div>
				<li> 
					<i class="bi bi-check-square"></i>
					<a class="off" href="https://github.com/Taming-the-BEAST/Structured-coalescent/commit/c56622ff573fcbaa04bd3f02bcc882ef2cbf04c0">
					08 Aug 2025 - <span class="text-gray">updated figures and text</span>
					</a> 
				</li>
			
				<div class="smallspacer"></div>
				<li> 
					<i class="bi bi-check-square"></i>
					<a class="off" href="https://github.com/Taming-the-BEAST/Structured-coalescent/commit/7c6b37560d64e9466ca88791273321583c44d641">
					01 Apr 2025 - <span class="text-gray">2.7 XML and precooked runs</span>
					</a> 
				</li>
			
			</ul>
		</div>		
		<div class="spacer"></div>	
	</div>
	</div>

	<div class="col-md-8">				
		<div class="post">
			<p>
			<h1 id="background">Background</h1>

<p>Population dynamics can influence the shape of a tree. Another thing that has strong influence on the shape of the tree is structure in a population. This is the case as soon as sequences do not mix well, i.e. they cluster together. One cause of this clustering is due to geography. Samples may not have been taken from the same geographic region, leading to clustering of samples from the same region. This clustering of samples can bias the estimation of parameters. The extension of the classic coalescent to the structured coalescent by allowing for migration between regions is trying to circumvent this by allowing individual regions to have distinct coalescent rates and by allowing migration between those regions.</p>

<hr />

<h1 id="programs-used-in-this-exercise">Programs used in this Exercise</h1>

<h3 id="beast2---bayesian-evolutionary-analysis-sampling-trees-2">BEAST2 - Bayesian Evolutionary Analysis Sampling Trees 2</h3>

<p>BEAST2 (<a href="http://www.beast2.org">http://www.beast2.org</a>) is a free software package for Bayesian evolutionary analysis of molecular sequences using MCMC and strictly oriented toward inference using rooted, time-measured phylogenetic trees. This tutorial is written for BEAST v2.7.x <a class="citation" href="#BEAST2book2014">(Drummond &amp; Bouckaert, 2014)</a>.</p>

<h3 id="beauti2---bayesian-evolutionary-analysis-utility">BEAUti2 - Bayesian Evolutionary Analysis Utility</h3>

<p>BEAUti2 is a graphical user interface tool for generating BEAST2 XML configuration files.</p>

<p>Both BEAST2 and BEAUti2 are Java programs, which means that the exact same code runs on all platforms. For us it simply means that the interface will be the same on all platforms. The screenshots used in this tutorial are taken on a Mac OS X computer; however, both programs will have the same layout and functionality on both Windows and Linux. BEAUti2 is provided as a part of the BEAST2 package so you do not need to install it separately.</p>

<h3 id="treeannotator">TreeAnnotator</h3>

<p>TreeAnnotator is used to summarise the posterior sample of trees to produce a maximum clade credibility tree. It can also be used to summarise and visualise the posterior estimates of other tree parameters (e.g. node height).</p>

<p>TreeAnnotator is provided as a part of the BEAST2 package so you do not need to install it separately.</p>

<h3 id="tracer">Tracer</h3>

<p>Tracer (<a href="http://tree.bio.ed.ac.uk/software/tracer">http://tree.bio.ed.ac.uk/software/tracer</a>) is used to summarise the posterior estimates of the various parameters sampled by the Markov Chain. This program can be used for visual inspection and to assess convergence. It helps to quickly view median estimates and 95% highest posterior density intervals of the parameters, and calculates the effective sample sizes (ESS) of parameters. It can also be used to investigate potential parameter correlations. We will be using Tracer v1.7.3.</p>

<h3 id="figtree">FigTree</h3>

<p>FigTree (<a href="http://tree.bio.ed.ac.uk/software/figtree">http://tree.bio.ed.ac.uk/software/figtree</a>) is a program for viewing trees and producing publication-quality figures. It can interpret the node-annotations created on the summary trees by TreeAnnotator, allowing the user to display node-based statistics (e.g. posterior probabilities). We will be using FigTree v1.4.x.</p>

<hr />

<h1 id="practical-multitypetree">Practical: MultiTypeTree</h1>

<p>In this tutorial we will estimate migration rates, effective population sizes and locations of internal nodes using the structured coalescent implemented in BEAST2, MultiTypeTree <a class="citation" href="#Vaughan2014">(Vaughan et al., 2014)</a>.</p>

<p>The aim is to:</p>

<ul>
  <li>Learn how to infer structure from trees with sampling location</li>
  <li>Get to know how to choose the set-up of such an analysis</li>
  <li>Get to know the advantages and disadvantages of working with structured trees</li>
</ul>

<h2 id="the-data">The Data</h2>
<p>The dataset consists of 60 Influenza A/H3N2 sequences sampled in Hong Kong and in New Zealand between 2001 and 2005. South-East Asia has been hypothesized to be a global source location of seasonal Influenza, while more temperate regions such as New Zealand are assumed to be global sinks (missing reference), meaning that Influenza strains are more likely to migrate from the tropic to the temperate regions then vice versa. We want to see if we can infer this source-sink dynamic from sequence data using the structured coalescent.</p>

<h2 id="creating-the-analysis-file-with-beauti">Creating the Analysis File with BEAUti</h2>

<p>We will use BEAUti to generate the input XML for BEAST2 from the sequence alignment.</p>

<h3 id="install-beast-2-plug-ins">Install BEAST 2 Plug-Ins</h3>

<p>The packages MultiTypeTree is not implemented in the core of BEAST, but has to be installed.</p>

<blockquote>
  <p>Launch <strong>BEAUTi</strong>
At the top menu, select <strong>File &gt; Manage</strong> packages.
Select MultiTypeTree in the package list.
Select <strong>INstall/Upgrade</strong> from the botom menu Figure <a href="#fig:install_mtt">1</a>.
Restart BEAUTi</p>
</blockquote>

<figure>
	<a id="fig:install_mtt"></a>
	<img src="figures/install_mtt.png" alt="" />
	<figcaption>Figure 1: Install MultiTypeTree.</figcaption>
</figure>
<p><br /></p>

<p>To be able to make <code class="language-plaintext highlighter-rouge">.xml</code>’s for MultiTypeTree, we have to load the MultiTypeTree template.</p>

<blockquote>
  <p>At the top menu in BEAUTi select <strong>File &gt; Template &gt; MultiTypeTree</strong>.</p>
</blockquote>

<p>This template allows to specify additional things, such as sampling location, which one can not specify using the standard interface, as well as parameters such as the migration rates.
After setting the template, we can load the alignment of the H3N2 data.</p>

<blockquote>
  <p>At the top menu in BEAUti select <strong>File &gt; Add Alignment</strong>.
Navigate to the location where you have saved the file <strong>h3n2_2deme.fna</strong>.
Select the file and click <strong>OK</strong>.</p>
</blockquote>

<p>Since the sequences were sampled through time, we have to specify the sampling dates. These are included in the sequence names.</p>

<blockquote>
  <p>Switch to <strong>Tip Dates</strong> tab.
Check the <strong>Use tip dates</strong> checkbox.
Click <strong>Auto-configure</strong>.
Select <strong>use everything &gt; after last</strong> and leave symbol as <strong>“_“</strong>.</p>
</blockquote>

<p>There are two different ways in how BEAST can interpret sampling dates. They are labeled as <strong>Since some time in the past</strong> and <strong>Before the present</strong>. The easiest way to check if you have used the correct one is by checking <code class="language-plaintext highlighter-rouge">Height</code>. If the setup is correct, the sequences sampled the most recently (i.e. 2005.66) should have a Height of 0 while all other tips should be larger then 0 (Figure <a href="#fig:sampling_dates">2</a>).</p>

<figure>
	<a id="fig:sampling_dates"></a>
	<img src="figures/dates.png" alt="" />
	<figcaption>Figure 2: Sampling dates.</figcaption>
</figure>
<p><br /></p>

<p>Since out population structure is defined geographically, we include additional information about the sampling location of sequences. Sequences were taken from patients in Hong Kong and New Zealand. We can specify these sampling locations:</p>

<blockquote>
  <p>Switch to <strong>Tip Locations</strong> tab in BEAUti
Select <strong>Guess</strong> 
Select **split on character”, leave the character as “_” and take group 2</p>
</blockquote>

<p>After guessing the tip locations, the column <strong>Location</strong> should contain the entries Hong Kong and New Zealand (Figure <a href="#fig:sampling_locations">3</a>).</p>

<figure>
	<a id="fig:sampling_locations"></a>
	<img src="figures/locations.png" alt="" />
	<figcaption>Figure 3: Sampling locations.</figcaption>
</figure>
<p><br /></p>

<p>For this analysis, we will be using the HKY model. The HKY model infers different rates for transversion and transition. Transition being the change within purines (<strong>A</strong> and <strong>G</strong>) and pyrimidines (<strong>T</strong> and <strong>C</strong>) and transversion being the change among those groups.</p>

<p>We also want to allow for heterogeneity between sites, which we can do by setting the <strong>Gamma Category Count</strong> to a value greater than 0 (normally between 4 and 6) and estimating the shape parameter (Figure <a href="#fig:hky">4</a>).</p>

<blockquote>
  <p>Switch to <strong>Site Model</strong> tab in BEAUTi.
Set <strong>Gamma Category Count</strong> to 4, leave <strong>Shape</strong> as 1.0 and <strong>estimate</strong> checkbox selected.
Select <strong>HKY</strong> as <strong>Subst Model</strong>, make sure <strong>estimate</strong> checkbox is selected.</p>
</blockquote>

<figure>
	<a id="fig:hky"></a>
	<img src="figures/choose_hky.png" alt="" />
	<figcaption>Figure 4: Setup of the site model.</figcaption>
</figure>
<p><br /></p>

<p>To speed up convergence, we leave the branch model on the Strict Clock model and  set a different value for the clock rate (default is 1). A value of 0.005 substitutions * site^(-1) * year^(-1)  is closer to the truth.</p>

<blockquote>
  <p>Switch to <strong>Clock Model</strong> tab in BEAUTi
set value as 0.005</p>
</blockquote>

<p>Since we have more than one deme (Hong Kong and New Zealand), we can estimate the effective population size of those two demes separately. Additionally, these demes are connected, so we can (or need to) allow for migration between them.
By default, the migration rates and population sizes are not estimated, we will change this.</p>

<blockquote>
  <p>Switch to <strong>Priors</strong> tab in BEAUTi
Expand <strong>structuredCoalescent</strong> line.
Check the two boxes for the <strong>estimate pop. sizes</strong> and <strong>estimate mig. rates</strong>. 
Now two more parameter priors appear. For <strong>rateMatrix</strong> select <strong>Exponential</strong> prior.</p>
</blockquote>

<p>After checking those two boxes, there will be two new fields appearing, where we can set the priors for the population sizes and the migration rates. 
Since we know the time scale of our data (few years), we can choose a proper prior for the migration rates, like an exponential prior distribution with mean 1.<br />
Figure <a href="#fig:est_migrates">5</a> shows the final setup for the priors.</p>

<figure>
	<a id="fig:est_migrates"></a>
	<img src="figures/estimate_migration.png" alt="" />
	<figcaption>Figure 5: Check the boxes that say estimate for the population size and the migration rates and change it to an exponential prior with mean 1.</figcaption>
</figure>
<p><br /></p>

<p>The rest of the settings we can leave as they are. Save your XML in order to run in BEAST2.</p>

<blockquote>
  <p>In BEAUTi top menu, select <strong>File &gt; save</strong> and choose your preferred location.
Launch BEAST2 and use the saved XML to start the run.</p>
</blockquote>

<p>After saving, we get an <code class="language-plaintext highlighter-rouge">*.xml</code>, which we can use in BEAST2. The run will take a bit of time. If the MultiTypeTree run consumes too much CPU power, you can just close it and then use the “pre-cooked” <code class="language-plaintext highlighter-rouge">*.log</code> and <code class="language-plaintext highlighter-rouge">*.trees</code> files later instead.</p>

<h3 id="analysis-of-the-multitypetree-run">Analysis of the MultiTypeTree run</h3>

<p>Load the <code class="language-plaintext highlighter-rouge">*.log</code> files into tracer. First, we should check that the run has converged by looking at the ESS values. If all ESS values are above 200, we should be on the safe side.</p>

<p>Next, we can have a look at the estimates of the effective population sizes (Figure <a href="#fig:estimated_peff">6</a>).</p>

<figure>
	<a id="fig:estimated_peff"></a>
	<img src="figures/effectivePsize_tracer.png" alt="" />
	<figcaption>Figure 6: Estimated effective population sizes.</figcaption>
</figure>
<p><br /></p>

<p>Hong Kong (<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>∼</mo></mrow><annotation encoding="application/x-tex">\sim</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.3669em;"></span><span class="mrel">∼</span></span></span></span>7 Mio Inhabitants) is inferred to have the larger effective population size than New Zealand (<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>∼</mo></mrow><annotation encoding="application/x-tex">\sim</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.3669em;"></span><span class="mrel">∼</span></span></span></span> 4.5 Mio Inhabitants). Keep in mind though that the effective population size is not only dependent on the population size itself, but also on e.g. transmission rates or contact rates. Differences in the real population size are therefore not necessarily reflected in the effective population size. However, they can still act as a sanity test. Next, we want to have a look at the inferred migration rates (Figure <a href="#fig:etimated_mig">7</a>).</p>

<figure>
	<a id="fig:etimated_mig"></a>
	<img src="figures/migrationrates_tracer.png" alt="" />
	<figcaption>Figure 7: Estimated migration rates.</figcaption>
</figure>
<p><br /></p>

<hr />

<p>As we stated at the beginning, it is assumed that South-East Asia works as a global source of influenza, while e.g. Oceania acts as a sink.</p>

<blockquote>
  <p>Do the inferred migration rates agree with this hypothesis?</p>
</blockquote>

<p>After having looked at the inferred parameters, we can look at the inferred trees.
We can either look at all the sampled trees individually or can use a summary of all tree. This can be done by using the program TreeAnnotator:</p>

<blockquote>
  <p>We need to specify at least 4 settings there. First, the burn-in percentage, then the input tree file, the output tree file for which we have to specify a file name and the <code class="language-plaintext highlighter-rouge">Node Heights</code> (set it to <code class="language-plaintext highlighter-rouge">Mean Heights</code>)</p>
</blockquote>

<p>MultiTypeTree logs 3 different tree files:</p>

<ul>
  <li>The first one is the <code class="language-plaintext highlighter-rouge">*.map.trees</code> file. It contains the maximum posterior tree for the analysis up to a sample of the MCMC. This tree is the tree with the highest posterior probability that has been visited so far.</li>
  <li>The second one is the <code class="language-plaintext highlighter-rouge">*.trees</code> file. It contains the logged trees with so called single child node. In a normal tree, all nodes have two (or sometimes more) children. The nodes there are coalescent events. The single child nodes on the other hand are migration events (in this case a migration event between Hong Kong and New Zealand). MultiTypeTree infers the timing of those migration events on a branch and logs them in the <code class="language-plaintext highlighter-rouge">*.trees</code> file.</li>
  <li>The third tree file logged is the <code class="language-plaintext highlighter-rouge">*.typedNode.trees</code>. This file does not use single child nodes. Instead, every coalescent event (here always a node with two daughter lineages) has a location (or state or color or type) where it was inferred to take place (see Figure <a href="#fig:single_child">8</a>)</li>
</ul>

<figure>
	<a id="fig:single_child"></a>
	<img src="figures/single_child.png" alt="" />
	<figcaption>Figure 8: An example of a tree where the migration events are logged as single child nodes (left) and of the same tree where only the location of a coalescent event is logged (right).</figcaption>
</figure>
<p><br /></p>

<p>To summarize all the trees, we will need the <code class="language-plaintext highlighter-rouge">*.typedNode.trees</code> files, since TreeAnnotator cannot handle single child nodes. We will also need to specify the <strong>Burnin percentage</strong>, which we can guess from looking at the traces of the parameter estimates in Tracer (10% should be more than enough). Next, we also need to specify where the output will be saved and under what name. After that, we can run the analysis.</p>

<p>When TreeAnnotator is finished, we can visualize the summarized MultiTypeTree run with FigTree.</p>

<blockquote>
  <p>Open the program and go to <code class="language-plaintext highlighter-rouge">File &gt; Open</code>, and open the output tree file from TreeAnnotator.</p>

  <p>To color the tree, go to <strong>Appearance</strong> and change <strong>Colour by</strong> and <strong>Width by</strong>.</p>

  <p>To get the coloring by inferred location, one has to set it to <strong>type</strong>. The expressions <strong>type, state, location and color</strong> are often used interchangeably.
The color gives the estimated (most likely) location of a node (red for Hong Kong and blue for New Zealand), the width gives the certainty of a color. The more certain the estimate is, the wider the branch above (towards the root of) the node. You can also change the <strong>Line Weight</strong> to better see difference in the width of branches.</p>
</blockquote>

<figure>
	<a id="fig:example"></a>
	<img src="figures/figtree_color.png" alt="" />
	<figcaption>Figure 9: Color tree according to the inferred location.</figcaption>
</figure>
<p><br /></p>

<p>Next, we would like to know how certain we are about the node heights.</p>

<blockquote>
  <p>This can be visualized by going to <strong>Node Bars</strong> and there <strong>Display</strong> the 95% HPD of node heights, which gives the 95% credibility interval of node heights (the mean is indicated by the shown node height).</p>
</blockquote>

<figure>
	<a id="fig:example"></a>
	<img src="figures/figtree_nodeheights.png" alt="" />
	<figcaption>Figure 10: Set the 95% HPD for the node heights.</figcaption>
</figure>
<p><br /></p>

<h3 id="some-considerations-for-using-the-structured-coalescent-or-any-structured-method">Some considerations for using the structured Coalescent (or any structured method)</h3>

<ul>
  <li>Inferring structure on a tree is hard and requires a lot of assumptions, e.g. that the migration rates don’t change over time or populations are constant.</li>
  <li>The number of migration events on a tree might be very low, to infer a rate from such a low number of events can be very hard. In general, it is easier to infer rates within a region (here the effective population size) than it is to infer rates between them, as there are simply more events within than between regions.</li>
  <li>Despite considering structure in a tree, there might still be states or locations etc. that were not sampled. Even if a node is inferred to be in a location with high certainty, the results could look completely different if samples from other locations would be considered as well.</li>
</ul>

<hr />

<h1 id="acknowledgment">Acknowledgment</h1>

<p>The content of this tutorial is based on the <a href="https://github.com/CompEvol/MultiTypeTree/wiki/Beginner's-Tutorial">MultiTypeTree</a> tutorial by Tim Vaughan.</p>

<h1 id="useful-links">Useful Links</h1>

<ul>
  <li><a href="http://www.beast2.org/book.html"><em>Bayesian Evolutionary Analysis with BEAST 2</em></a>  <a class="citation" href="#BEAST2book2014">(Drummond &amp; Bouckaert, 2014)</a></li>
  <li>BEAST 2 website and documentation: <a href="http://www.beast2.org/">http://www.beast2.org/</a></li>
  <li>BEAST 1 website and documentation: <a href="http://beast.bio.ed.ac.uk">http://beast.bio.ed.ac.uk</a></li>
  <li>Join the BEAST user discussion: <a href="http://groups.google.com/group/beast-users">http://groups.google.com/group/beast-users</a></li>
</ul>

<hr />

<h1 id="relevant-references">Relevant References</h1>

<ol class="bibliography"><li><span id="BEAST2book2014">Drummond, A. J., &amp; Bouckaert, R. R. (2014). <i>Bayesian evolutionary analysis with BEAST 2</i>. Cambridge University Press.</span></li>
<li><span id="Vaughan2014">Vaughan, T. G., Kühnert, D., Popinga, A., Welch, D., &amp; Drummond, A. J. (2014). Efficient Bayesian inference under the structured coalescent. <i>Bioinformatics (Oxford, England)</i>, <i>30</i>(16), 2272–2279. https://doi.org/10.1093/bioinformatics/btu201</span></li></ol>


			<hr>
			<h1>Citation</h1>

			
<p>If you found <strong>Taming the BEAST</strong> helpful in designing your research, please cite the following paper:</p>

<p style="margin-left: 40px">
Joëlle Barido-Sottani, Veronika Bošková, Louis du Plessis, Denise Kühnert, Carsten Magnus, Venelin Mitov, Nicola F. Müller, Jūlija Pečerska, David A. Rasmussen, Chi Zhang, Alexei J. Drummond, Tracy A. Heath, Oliver G. Pybus, Timothy G. Vaughan, Tanja Stadler (2018). Taming the BEAST – A community teaching material resource for BEAST 2. <em>Systematic Biology</em>, <em>67(1)</em>, 170–-174. doi: <a target="_blank" href="https://doi.org/10.1093/sysbio/syx060">10.1093/sysbio/syx060</a>
</p> 
		</div>
	</div>			
	<div class="col-md-1"></div>
</div>


	
	</div>

	<div class="footerspacer"></div>

<div class="footer">
  <div class="container">
    <div class="row">
      <div class="col-md-6">
        <ul class="list-group list-group-horizontal">
        <li class="footernav list-group-item"><a class="foot" href="/about/">about</a></li>
        <li class="footernav list-group-item"><a class="foot" href="/contact/">contact</a></li>
        <li class="footernav list-group-item"><a class="foot" href="/license/">license</a></li>
        </ul>
      </div>
      <div class="col-md-6">
        <div class="footer-logo">
          <a href="https://www.sib.swiss/services/open-software-and-databases">
            <img src="/images/sib_logo2023.png" width="130">
          </a>
        </div>
      </div>
    </div>
  </div>
</div>

	
	<!--div id="footer"><span style="display:none">foo</span></div-->
		
</body>
</html>

